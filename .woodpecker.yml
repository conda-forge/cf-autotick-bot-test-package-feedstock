pipeline:
  build:
    image: ${DOCKER_IMAGE}
    commands:
      - export FEEDSTOCK_ROOT="$CI_WORKSPACE"
      - export RECIPE_ROOT="$FEEDSTOCK_ROOT/recipe"
      - export CI=drone
      - export GIT_BRANCH="$DRONE_BRANCH"
      - export FEEDSTOCK_NAME=$(basename ${DRONE_REPO_NAME})
      - export IS_PR_BUILD=$(if [[ "$${DRONE_PULL_REQUEST:-}" == "" ]]; then echo "False"; else echo "True"; fi)
      - sed -i '$ichown -R conda:conda "$FEEDSTOCK_ROOT"' /opt/docker/bin/entrypoint
      - /opt/docker/bin/entrypoint $FEEDSTOCK_ROOT/.scripts/build_steps.sh
      - echo "Done building"


matrix:
  include:
    - CONFIG: linux_aarch64_python3.7.____cpython
      UPLOAD_PACKAGES: True
      PLATFORM: linux-aarch64
      DOCKER_IMAGE: quay.io/condaforge/linux-anvil-aarch64

    - CONFIG: linux_aarch64_python3.8.____cpython
      UPLOAD_PACKAGES: True
      PLATFORM: linux-aarch64
      DOCKER_IMAGE: quay.io/condaforge/linux-anvil-aarch64

    - CONFIG: linux_aarch64_python3.9.____cpython
      UPLOAD_PACKAGES: True
      PLATFORM: linux-aarch64
      DOCKER_IMAGE: quay.io/condaforge/linux-anvil-aarch64
